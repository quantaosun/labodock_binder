# Labodock_binder
[![My Skills](https://skillicons.dev/icons?i=linux,anaconda&perline=3)](https://skillicons.dev)

The most reliable manner is to install this reposititory to a local Linux with conda based on ```environment.yml``` provided. But if you do not have a Linux and/or Conda environment, you can
still use the cloud version below.

## Cloud 
[![badge](https://img.shields.io/badge/Labodock-Binder-E66581.svg?logo=data:image/png;base64,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)](https://mybinder.org/v2/zenodo/10.5281/zenodo.10208365/?labpath=wedock.ipynb)

### In-house receptor docking

[![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/quantaosun/labodock_binder.git/HEAD?labpath=labodock_native_interaction%2Fwebdock_in_house.ipynb)

## Use on Windows 
[![My Skills](https://skillicons.dev/icons?i=windows,docker&perline=3)](https://skillicons.dev)

We here use **Docker** as a container, to mimic a Linux machine


I assume you already installed **Docker-desktop**, and started it on the back.
Also, I assume you already launched Windows **PowerShell** (The blue one) and have navigated to a folder where you want to do docking. Run:

```
docker pull qutesun/labodock_binder
docker run -p 8888:8888 -v ${PWD}:/home/jovyan/work qutesun/wemd
```
Your **PowerShell** terminal will output some crazy lines that you probably can't read properly, among which there will be a token pin, just copy it.

Now go to your default browser, and try 

```
localhost:8888
```
your browser will start a Jupyter Notebook interface and ask for a token pin, which you have coped from the backend in the **PowerShell** interface.

After having entered the browser interface, double click ```wedock_win.ipynb```, and you are ready to do the docking just as if you using the Binder badge above. 

## 
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.10208365.svg)](https://doi.org/10.5281/zenodo.10208365)

[![version](https://img.shields.io/badge/version-0.0.2-orange)](https://github.com/quantaosun/labodock_binder/releases)

[![license](https://img.shields.io/badge/license-MIT-yellow)](https://github.com/quantaosun/labodock_binder/blob/main/LICENSE)

## 百度平台用户
请使用手机号码注册登陆百度飞浆，在公开项目中搜索本仓库名称，复刻到本人名下，点击启动环境运行，在命令行内生成新环境后，开始在笔记本内完成对接。受制于百度平台的维护策略，在项目关闭后我们创建的环境将被清除，下次启动时请再次安装。

## What happens once you click the launch binder badge?

This Binder section is copied from https://discourse.jupyter.org/t/how-to-reduce-mybinder-org-repository-startup-time/4956 

Each time a user clicks a Binder link, these things happen:

A slot (called a “pod”) is reserved on one of the cloud machines. This takes 1-2 seconds.
Binder looks to see if a Docker image exists for that repository
If it doesn’t, Binder must first build the image for that repo using repo2docker (this takes time)
The binder looks for a built image on the machine the user will use
If it isn’t on the machine, Binder must first pull the image onto that machine (this takes time)
Binder launches the user’s session. This includes:
a small amount of time to start the “init pods to limit network access”,
a few seconds for the Jupyter process to start,
a few seconds for BinderHub to notice,
and finally, your browser needs to follow the redirect.

## Introduction
labodock_binder is an enhanced iteration of Labodock (https://github.com/RyanZR/labodock), primarily focusing on improved accessibility and user-friendliness. Notable modifications from Labodock version 2.0.0 include:

**Seamless Access**: Unlike the original Google Colab login requirement, labodock_binder allows free access from Chrome, Firefox, and Safari, without the need for signup or login. This is made possible through the implementation of Binder technology (https://mybinder.org/).

**Pre-built Images**: The labodock_binder image is pre-built. When a user clicks the link, the image is pulled from the cloud to the local browser, instead of installing all packages from scratch. This significantly accelerates the readiness for docking.

**Simplified Execution**: labodock_binder streamlines the process with one-click execution, eliminating the need for repetitive variable modifications.

**High Safety Standard**:All code executed, data analyzed, and files uploaded during a Binder session, including any modifications to the docking notebook, are automatically deleted when the user logs off or becomes inactive for a few minutes. This ensures that there's no concern about temporary uploads, such as small molecule structures, being leaked. Additionally, Binder retains only the IP addresses associated with the service visits for 30 days, and this information is solely utilized to identify potential abuse of the Binder service. Rest assured that all modifications to the docking notebook are automatically cleared upon closing the browser window, and the platform prioritizes user privacy by minimizing data retention

These enhancements collectively contribute to a more user-friendly and accessible experience. labodock_binder emerges as a versatile and convenient tool for users worldwide, requiring only internet availability—no Google account necessary.

<img width="775" alt="image" src="https://github.com/quantaosun/labodock_binder/assets/75652473/d0333255-36f2-46da-a105-5290bd91a063">


## Usage
**PDB_ID** is a four-letter code from the PDB bank website, for example, 3HTB

**Native_lig** below means the native ligand of the co-crystal structure of the PDB bank, it can be found on the PDB website, it should always be a three-letter code, for example, JZ4

**smiles** is the small molecule you want to dock, you can obtain this from ChemDraw, from **Edit** > **Copy as smiles**

(In wedock2.ipynb, **smiles** variable was replaced by a CSV file containing multiple smiles)

The first three cells are the only thing you should modify. From the top left, click **Run** > **Run All Cells**, and the docking will start automatically. Your docked 3D interaction diagram will be at the bottom of the notebook.


## Acknowledgments

- Credits to the [Labodock](https://github.com/RyanZR/labodock) project for developing an excellent and open-source suite for docking on Google Colab.
- Credits to the [Binder](https://mybinder.org/) project for developing the fantastic interactive Jupiter notebook used on web browsers.

<img width="932" alt="image" src="https://github.com/quantaosun/labodock_binder/assets/75652473/402c00b8-4d6a-4023-a891-e73a8ca3d3e3">



## If docking with a local PDB complex, for example, an in-house structure, change this native ligand section, Instead of downloading the native ligand from online, it directly greps out the native ligand from a local PDB

```

Keyword = Native_lig # @param {type: 'string'}

def get_molblock(keyword: str) -> str:
    url_path = PRT_FLD
    pdb_file = os.path.join(NTV_FLD, Keyword + '.pdb')
    sdf_file = os.path.join(NTV_FLD, keyword + '.sdf')
    os.system(f'grep {keyword} {PDB_pdb_pFile} -O {pdb_file}')
    os.system(f'obabel -ipdb {pdb_file} -osdf -O {sdf_file}')
    molblock = [mol for mol in  Chem.SDMolSupplier(sdf_file) if mol is not None][0]
    os.remove(sdf_file)
    return molblock

def correct_bond_order(inpt_list: list, temp: Chem.rdchem.Mol) -> None:
    for inpt_file in inpt_list:
        targ = AllChem.MolFromPDBFile(inpt_file)
        cmol = AllChem.AssignBondOrdersFromTemplate(temp, targ)
        pdbb = Chem.MolToPDBBlock(cmol, flavor=4)
        with open(inpt_file, 'w') as oupt:
            oupt.write(pdbb)

true_id = Keyword[-3:] if len(Keyword) > 3 else Keyword
print(f'+ RCSB PDB link: https://www.rcsb.org/ligand/{true_id}')

ntv_pdb = Keyword.upper() + '.pdb'
ntv_pdb_nFile = os.path.join(NTV_FLD, ntv_pdb)
extract_entity(PDB_pdb_pFile, ntv_pdb_nFile, [Keyword, 'HETATM'])
extract_chains(ntv_pdb_nFile)

ntv_nFiles = sorted(glob.glob(NTV_FLD + '/' + Keyword + '_A.pdb'))
ntv_smiles = get_molblock(true_id)
correct_bond_order(ntv_nFiles, ntv_smiles)
```


